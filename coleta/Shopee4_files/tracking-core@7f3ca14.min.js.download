self.window.trackingSDK.define(["exports"],(function(e){"use strict";var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};var n,o=function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)};function r(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))}function i(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function s(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}var a=new Uint8Array(16);function c(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(a)}var u=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function f(e){return"string"==typeof e&&u.test(e)}for(var p=[],l=0;l<256;++l)p.push((l+256).toString(16).substr(1));function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(p[e[t+0]]+p[e[t+1]]+p[e[t+2]]+p[e[t+3]]+"-"+p[e[t+4]]+p[e[t+5]]+"-"+p[e[t+6]]+p[e[t+7]]+"-"+p[e[t+8]]+p[e[t+9]]+"-"+p[e[t+10]]+p[e[t+11]]+p[e[t+12]]+p[e[t+13]]+p[e[t+14]]+p[e[t+15]]).toLowerCase();if(!f(n))throw TypeError("Stringified UUID is invalid");return n}var v="6ba7b810-9dad-11d1-80b4-00c04fd430c8",h="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function E(e,t,n){function o(e,o,r,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof o&&(o=function(e){if(!f(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n}(o)),16!==o.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+e.length);if(s.set(o),s.set(e,o.length),(s=n(s))[6]=15&s[6]|t,s[8]=63&s[8]|128,r){i=i||0;for(var a=0;a<16;++a)r[i+a]=s[a];return r}return d(s)}try{o.name=e}catch(e){}return o.DNS=v,o.URL=h,o}function S(e){return 14+(e+64>>>9<<4)+1}function y(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function g(e,t,n,o,r,i){return y((s=y(y(t,e),y(o,i)))<<(a=r)|s>>>32-a,n);var s,a}function b(e,t,n,o,r,i,s){return g(t&n|~t&o,e,t,r,i,s)}function m(e,t,n,o,r,i,s){return g(t&o|n&~o,e,t,r,i,s)}function O(e,t,n,o,r,i,s){return g(t^n^o,e,t,r,i,s)}function T(e,t,n,o,r,i,s){return g(n^(t|~o),e,t,r,i,s)}function _(e,t,n){var o=(e=e||{}).random||(e.rng||c)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=o[r];return t}return d(o)}function I(e,t,n,o){switch(e){case 0:return t&n^~t&o;case 1:case 3:return t^n^o;case 2:return t&n^t&o^n&o}}function w(e,t){return e<<t|e>>>32-t}E("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,o="0123456789abcdef",r=0;r<n;r+=8){var i=e[r>>5]>>>r%32&255,s=parseInt(o.charAt(i>>>4&15)+o.charAt(15&i),16);t.push(s)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[S(t)-1]=t;for(var n=1732584193,o=-271733879,r=-1732584194,i=271733878,s=0;s<e.length;s+=16){var a=n,c=o,u=r,f=i;n=b(n,o,r,i,e[s],7,-680876936),i=b(i,n,o,r,e[s+1],12,-389564586),r=b(r,i,n,o,e[s+2],17,606105819),o=b(o,r,i,n,e[s+3],22,-1044525330),n=b(n,o,r,i,e[s+4],7,-176418897),i=b(i,n,o,r,e[s+5],12,1200080426),r=b(r,i,n,o,e[s+6],17,-1473231341),o=b(o,r,i,n,e[s+7],22,-45705983),n=b(n,o,r,i,e[s+8],7,1770035416),i=b(i,n,o,r,e[s+9],12,-1958414417),r=b(r,i,n,o,e[s+10],17,-42063),o=b(o,r,i,n,e[s+11],22,-1990404162),n=b(n,o,r,i,e[s+12],7,1804603682),i=b(i,n,o,r,e[s+13],12,-40341101),r=b(r,i,n,o,e[s+14],17,-1502002290),n=m(n,o=b(o,r,i,n,e[s+15],22,1236535329),r,i,e[s+1],5,-165796510),i=m(i,n,o,r,e[s+6],9,-1069501632),r=m(r,i,n,o,e[s+11],14,643717713),o=m(o,r,i,n,e[s],20,-373897302),n=m(n,o,r,i,e[s+5],5,-701558691),i=m(i,n,o,r,e[s+10],9,38016083),r=m(r,i,n,o,e[s+15],14,-660478335),o=m(o,r,i,n,e[s+4],20,-405537848),n=m(n,o,r,i,e[s+9],5,568446438),i=m(i,n,o,r,e[s+14],9,-1019803690),r=m(r,i,n,o,e[s+3],14,-187363961),o=m(o,r,i,n,e[s+8],20,1163531501),n=m(n,o,r,i,e[s+13],5,-1444681467),i=m(i,n,o,r,e[s+2],9,-51403784),r=m(r,i,n,o,e[s+7],14,1735328473),n=O(n,o=m(o,r,i,n,e[s+12],20,-1926607734),r,i,e[s+5],4,-378558),i=O(i,n,o,r,e[s+8],11,-2022574463),r=O(r,i,n,o,e[s+11],16,1839030562),o=O(o,r,i,n,e[s+14],23,-35309556),n=O(n,o,r,i,e[s+1],4,-1530992060),i=O(i,n,o,r,e[s+4],11,1272893353),r=O(r,i,n,o,e[s+7],16,-155497632),o=O(o,r,i,n,e[s+10],23,-1094730640),n=O(n,o,r,i,e[s+13],4,681279174),i=O(i,n,o,r,e[s],11,-358537222),r=O(r,i,n,o,e[s+3],16,-722521979),o=O(o,r,i,n,e[s+6],23,76029189),n=O(n,o,r,i,e[s+9],4,-640364487),i=O(i,n,o,r,e[s+12],11,-421815835),r=O(r,i,n,o,e[s+15],16,530742520),n=T(n,o=O(o,r,i,n,e[s+2],23,-995338651),r,i,e[s],6,-198630844),i=T(i,n,o,r,e[s+7],10,1126891415),r=T(r,i,n,o,e[s+14],15,-1416354905),o=T(o,r,i,n,e[s+5],21,-57434055),n=T(n,o,r,i,e[s+12],6,1700485571),i=T(i,n,o,r,e[s+3],10,-1894986606),r=T(r,i,n,o,e[s+10],15,-1051523),o=T(o,r,i,n,e[s+1],21,-2054922799),n=T(n,o,r,i,e[s+8],6,1873313359),i=T(i,n,o,r,e[s+15],10,-30611744),r=T(r,i,n,o,e[s+6],15,-1560198380),o=T(o,r,i,n,e[s+13],21,1309151649),n=T(n,o,r,i,e[s+4],6,-145523070),i=T(i,n,o,r,e[s+11],10,-1120210379),r=T(r,i,n,o,e[s+2],15,718787259),o=T(o,r,i,n,e[s+9],21,-343485551),n=y(n,a),o=y(o,c),r=y(r,u),i=y(i,f)}return[n,o,r,i]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(S(t)),o=0;o<t;o+=8)n[o>>5]|=(255&e[o/8])<<o%32;return n}(e),8*e.length))})),E("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var o=unescape(encodeURIComponent(e));e=[];for(var r=0;r<o.length;++r)e.push(o.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var i=e.length/4+2,s=Math.ceil(i/16),a=new Array(s),c=0;c<s;++c){for(var u=new Uint32Array(16),f=0;f<16;++f)u[f]=e[64*c+4*f]<<24|e[64*c+4*f+1]<<16|e[64*c+4*f+2]<<8|e[64*c+4*f+3];a[c]=u}a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295;for(var p=0;p<s;++p){for(var l=new Uint32Array(80),d=0;d<16;++d)l[d]=a[p][d];for(var v=16;v<80;++v)l[v]=w(l[v-3]^l[v-8]^l[v-14]^l[v-16],1);for(var h=n[0],E=n[1],S=n[2],y=n[3],g=n[4],b=0;b<80;++b){var m=Math.floor(b/20),O=w(h,5)+I(m,E,S,y)+g+t[m]+l[b]>>>0;g=y,y=S,S=w(E,30)>>>0,E=h,h=O}n[0]=n[0]+h>>>0,n[1]=n[1]+E>>>0,n[2]=n[2]+S>>>0,n[3]=n[3]+y>>>0,n[4]=n[4]+g>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}));var N={currentSessionId:""},C=function(){function e(e,t){this.storage=e,this.storageKey=t}return e.prototype.get=function(){return this.storage.get(this.storageKey)||[]},e.prototype.set=function(e){return e=e||[],this.storage.set(this.storageKey,e)},e.prototype.enqueue=function(e){var t=this.get();t.push(e),this.set(t)},e.prototype.batchDequeue=function(e){if(0!==e.length){var t=this.get(),n=[];t.forEach((function(t,o){e.includes(o)||n.push(t)})),this.set(n)}},e.prototype.putBackBatchToQueue=function(e){return this.set(e.concat(this.get()))},e}(),R=function(){function e(){var t=this;this.backStore={},this.storage={get:function(e){return t.backStore[e]},set:function(e,n){return t.backStore[e]=n,!0}},this.queue=new C(this.storage,e.QUEUE_STORAGE_KEY)}return e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.init=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,void 0]}))}))},e.prototype.addEvent=function(e,t){return void 0===t&&(t="ubt"),this.queue.enqueue({data:e,type:t}),Promise.resolve()},e.prototype.getEvents=function(e,t){void 0===t&&(t="ubt");for(var n=this.queue.get(),o=[],r=[],i=0;i<n.length;i++){var s=n[i];if(s.type===t&&(o.push(s.data),r.push(i)),o.length===e)break}return this.queue.batchDequeue(r),Promise.resolve({data:o})},e.prototype.resetEvents=function(e,t,n){void 0===n&&(n="ubt");var o=[];return t.forEach((function(e){o.push({data:e,type:n})})),this.queue.putBackBatchToQueue(o),Promise.resolve()},e.prototype.removeEvents=function(e){return Promise.resolve()},e.prototype.getSession=function(t,n){var r,i=this.storage.get(e.SESSION_STORAGE_KEY),s=o({},null==i?void 0:i.sequenceIds),a=isNaN(s[t])?0:s[t];return i=n(i=i&&"sessionId"in i&&"number"==typeof a&&"timestamp"in i?o(o({},i),{sequenceId:a,sequenceIds:s}):void 0),this.storage.set(e.SESSION_STORAGE_KEY,{sessionId:i.sessionId,timestamp:i.timestamp,initTimestamp:i.initTimestamp,sequenceId:i.sequenceId,sequenceIds:o(o({},s),(r={},r[t]=i.sequenceId,r))}),Promise.resolve(i)},e.prototype.getCurrentSessionId=function(){var t=this.storage.get(e.SESSION_STORAGE_KEY),n=t&&"sessionId"in t?t.sessionId:void 0;return Promise.resolve(n)},e.prototype.getCurrentSessionInitTime=function(){var t=this.storage.get(e.SESSION_STORAGE_KEY),n=t&&"initTimestamp"in t?t.initTimestamp:void 0;return Promise.resolve(n)},e.prototype.removeExpiredEvents=function(){return Promise.resolve()},e.QUEUE_STORAGE_KEY="bi-tracking::events",e.SESSION_STORAGE_KEY="bi-tracking::session",e.CHECK_STORAGE_KEY="bi-tracking::check",e}(),P=function(){function e(e){void 0===e&&(e=4),this.DATABASE_VERSION=4,this.DATABASE_VERSION=e}return e.prototype.init=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this.openDB(e.DATABASE_NAME,this.DATABASE_VERSION)];case 1:return t=n.sent(),this.idb=t,this.deleteDirtyData(),[2]}}))}))},e.prototype.deleteDirtyData=function(){var t=this.idb.transaction(e.OBJECT_STORE_EVENTS,"readwrite"),n=IDBKeyRange.only("t"),r=t.objectStore(e.OBJECT_STORE_EVENTS).index(e.INDEX_EVENTS_FETCHED).openCursor(n);r.onsuccess=function(){var e=r.result;if(e){var t=e.value.timestamp;Date.now()-t>864e5&&e.update(o(o({},e.value),{fetched:"f"})),e.continue()}}},e.prototype.upgrade=function(t,n){if(n.oldVersion<this.DATABASE_VERSION&&(t.objectStoreNames.contains(e.OBJECT_STORE_EVENTS)&&t.deleteObjectStore(e.OBJECT_STORE_EVENTS),t.objectStoreNames.contains(e.OBJECT_STORE_EVENTS_V1)&&t.deleteObjectStore(e.OBJECT_STORE_EVENTS_V1),t.objectStoreNames.contains(e.OBJECT_STORE_SESSIONS_V1)&&t.deleteObjectStore(e.OBJECT_STORE_SESSIONS_V1)),!t.objectStoreNames.contains(e.OBJECT_STORE_EVENTS)){var o=t.createObjectStore(e.OBJECT_STORE_EVENTS,{autoIncrement:!0});o.createIndex(e.INDEX_EVENTS_FETCHED,e.INDEX_EVENTS_FETCHED,{unique:!1}),o.createIndex(e.INDEX_EVENT_TIMESTAMP,e.INDEX_EVENT_TIMESTAMP,{unique:!1})}t.objectStoreNames.contains(e.OBJECT_STORE_SESSIONS)||t.createObjectStore(e.OBJECT_STORE_SESSIONS)},e.prototype.openDB=function(t,n){var o=this;return new Promise((function(r,i){var s=self.window.indexedDB.open(t,n);s.onblocked=function(){console.warn("[IndexedDBStorage] Upgrade is blocked since connection to old version exists.")},s.onerror=function(e){try{e.preventDefault()}catch(e){}i(e)},s.onsuccess=function(){var t=s.result;t.objectStoreNames.contains(e.OBJECT_STORE_EVENTS)&&t.objectStoreNames.contains(e.OBJECT_STORE_SESSIONS)?(t.onerror=function(e){console.warn("[IndexedDBStorage]",e.errorCode)},t.onversionchange=function(){t.close(),console.warn("[IndexedDBStorage] A new version of indexedDB is ready.")},r(t)):i("Required ObjectStore cannot be found.")},s.onupgradeneeded=function(e){var t=s.result;try{o.upgrade(t,e)}catch(e){i(e)}}}))},e.prototype.addEvent=function(t,n){var o=this;return void 0===n&&(n="ubt"),new Promise((function(r,i){var s=o.idb.transaction(e.OBJECT_STORE_EVENTS,"readwrite");s.oncomplete=function(){r()},s.onerror=function(e){i(e)},s.onabort=function(e){i(e)},s.objectStore(e.OBJECT_STORE_EVENTS).add({data:JSON.stringify(t),timestamp:Date.now(),fetched:"f",type:n})}))},e.prototype.getEvents=function(t,n){var r=this;void 0===n&&(n="ubt");var i=[],s=[];return new Promise((function(a,c){var u=r.idb.transaction(e.OBJECT_STORE_EVENTS,"readwrite");u.oncomplete=function(){a({keys:i,data:s})},u.onerror=function(e){c(e)},u.onabort=function(e){c(e)};var f=IDBKeyRange.only("f"),p=u.objectStore(e.OBJECT_STORE_EVENTS).index(e.INDEX_EVENTS_FETCHED).openCursor(f);p.onsuccess=function(){var e=p.result;e&&((n===e.value.type||!e.value.type&&"ubt"===n)&&(i.push(e.primaryKey),s.push(JSON.parse(e.value.data)),e.update(o(o({},e.value),{fetched:"t"}))),(-1===t||s.length<t)&&e.continue())}}))},e.prototype.resetEvents=function(t){var n=this;return!t||t.length<=0?Promise.resolve():new Promise((function(r,i){var s=n.idb.transaction(e.OBJECT_STORE_EVENTS,"readwrite");s.oncomplete=function(){r()},s.onerror=function(e){i(e)},s.onabort=function(e){i(e)};var a=IDBKeyRange.bound(t[0],t[t.length-1]),c=s.objectStore(e.OBJECT_STORE_EVENTS).openCursor(a);c.onsuccess=function(){var e=c.result;e&&(e.update(o(o({},e.value),{fetched:"f"})),e.continue())}}))},e.prototype.removeEvents=function(t){var n=this;return!t||t.length<=0?Promise.resolve():new Promise((function(o,r){var i=n.idb.transaction(e.OBJECT_STORE_EVENTS,"readwrite");i.oncomplete=function(){o()},i.onerror=function(e){r(e)},i.onabort=function(e){r(e)};var s=IDBKeyRange.bound(t[0],t[t.length-1]);i.objectStore(e.OBJECT_STORE_EVENTS).delete(s)}))},e.prototype.getSession=function(t,n){var r=this;return new Promise((function(i,s){var a,c=r.idb.transaction(e.OBJECT_STORE_SESSIONS,"readwrite");c.oncomplete=function(){i(a)},c.onerror=function(e){s(e)},c.onabort=function(e){s(e)};var u=c.objectStore(e.OBJECT_STORE_SESSIONS);new Promise((function(t,n){var o=u.get(e.KEY_SESSION);o.onsuccess=function(){return t(o.result)},o.onerror=function(){return n()}})).then((function(r){var i,s;if(r){s=o({},r.sequenceIds);var c=isNaN(s[t])?0:s[t];a=n(o(o({},r),{sequenceIds:s,sequenceId:c}))}else a=n();u.put({sessionId:a.sessionId,timestamp:a.timestamp,initTimestamp:a.initTimestamp,sequenceIds:o(o({},s),(i={},i[t]=a.sequenceId,i))},e.KEY_SESSION)}))}))},e.prototype.getCurrentSessionInitTime=function(){var t=this;return new Promise((function(n,o){var r,i=t.idb.transaction(e.OBJECT_STORE_SESSIONS,"readwrite");i.oncomplete=function(){n(null==r?void 0:r.initTimestamp)},i.onerror=function(e){o(e)},i.onabort=function(e){o(e)};var s=i.objectStore(e.OBJECT_STORE_SESSIONS).get(e.KEY_SESSION);s.onsuccess=function(){r=s.result}}))},e.prototype.getCurrentSessionId=function(){var t=this;return new Promise((function(n,o){var r,i=t.idb.transaction(e.OBJECT_STORE_SESSIONS,"readwrite");i.oncomplete=function(){n(null==r?void 0:r.sessionId)},i.onerror=function(e){o(e)},i.onabort=function(e){o(e)};var s=i.objectStore(e.OBJECT_STORE_SESSIONS).get(e.KEY_SESSION);s.onsuccess=function(){r=s.result}}))},e.prototype.removeExpiredEvents=function(){var t=this;return new Promise((function(n,o){var r=t.idb.transaction(e.OBJECT_STORE_EVENTS,"readwrite");r.oncomplete=function(){n()},r.onerror=function(e){o(e)},r.onabort=function(e){o(e)};var i=IDBKeyRange.upperBound(Date.now()-e.RETENTION),s=r.objectStore(e.OBJECT_STORE_EVENTS).index(e.INDEX_EVENT_TIMESTAMP).openCursor(i);s.onsuccess=function(){var e=s.result;e&&(e.delete(),e.continue())}}))},e.DATABASE_NAME="data-tracking",e.OBJECT_STORE_EVENTS_V1="events",e.OBJECT_STORE_EVENTS="events_v2",e.OBJECT_STORE_SESSIONS_V1="sessions",e.OBJECT_STORE_SESSIONS="session_v2",e.INDEX_EVENTS_FETCHED="fetched",e.INDEX_EVENT_TIMESTAMP="timestamp",e.KEY_SESSION="current_session",e.RETENTION=1728e5,e}(),B="",x="",A=new(function(){function e(){}return e.prototype.useStorage=function(e){this.trackerStorage?e instanceof P&&this.trackerStorage instanceof R&&(this.trackerStorage=e):this.trackerStorage=e},e.prototype.getSessionInitTime=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.trackerStorage.getCurrentSessionInitTime()];case 1:return[2,e.sent()]}}))}))},e.prototype.getSession=function(t){var n=t.flag,o=t.reset,s=void 0!==o&&o;return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.trackerStorage.getSession(n,(function(t){var n=Date.now();return!0===s||null==t||n-t.timestamp>e.SESSION_DURATION?t={sessionId:_(),timestamp:n,initTimestamp:n,sequenceId:0,sequenceIds:{}}:N.currentSessionId&&N.currentSessionId!==t.sessionId?(t.sequenceId=0,t.timestamp=n):(t.sequenceId+=1,t.timestamp=n),N.currentSessionId=t.sessionId,t}))];case 1:return[2,t.sent()]}}))}))},e.prototype.GetSessionId=function(e){var t=e.flag,n=e.reset,o=void 0!==n&&n;return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,this.trackerStorage.getCurrentSessionId()];case 1:return(e=n.sent())?[2,e]:[4,this.getSession({flag:t,reset:o})];case 2:return[2,n.sent().sessionId]}}))}))},e.prototype.setLatestEventId=function(e){B=e},e.prototype.getLatestEventId=function(){return B},e.prototype.setLatestViewPageType=function(e){x=e},e.prototype.getLatestViewPageType=function(){return x},e.SESSION_DURATION=18e5,e}()),D="object"==typeof self?self:"object"==typeof window?window:"object"==typeof top&&top||{},k=D.document||{},V=D.location||{},j=D.navigator||{};var J={sg:".sg",my:".com.my",id:".co.id",th:".co.th",ph:".ph",vn:".vn",tw:".tw",co:".com.co",cl:".cl",mx:".com.mx",br:".com.br"},q=o(o({},{test:"test.",stable:"test-stable.",staging:"staging.",liveish:"live-test.",live:"",sandbox:"sandbox.",uat:"uat."}),{liveish:""});var U="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var M={exports:{}};!function(e,t){!function(n,o){var r={};n.PubSub?(r=n.PubSub,console.warn("PubSub already loaded, using existing version")):(n.PubSub=r,function(e){var t={},n=-1,o="*";function r(e){var t;for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!0;return!1}function i(e){return function(){throw e}}function s(e,t,n){try{e(t,n)}catch(e){setTimeout(i(e),0)}}function a(e,t,n){e(t,n)}function c(e,n,o,r){var i,c=t[n],u=r?a:s;if(Object.prototype.hasOwnProperty.call(t,n))for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&u(c[i],e,o)}function u(e,t,n){return function(){var r=String(e),i=r.lastIndexOf(".");for(c(e,e,t,n);-1!==i;)i=(r=r.substr(0,i)).lastIndexOf("."),c(e,r,t,n);c(e,o,t,n)}}function f(e){var n=String(e);return Boolean(Object.prototype.hasOwnProperty.call(t,n)&&r(t[n]))}function p(e){for(var t=String(e),n=f(t)||f(o),r=t.lastIndexOf(".");!n&&-1!==r;)r=(t=t.substr(0,r)).lastIndexOf("."),n=f(t);return n}function l(e,t,n,o){var r=u(e="symbol"==typeof e?e.toString():e,t,o);return!!p(e)&&(!0===n?r():setTimeout(r,0),!0)}e.publish=function(t,n){return l(t,n,!1,e.immediateExceptions)},e.publishSync=function(t,n){return l(t,n,!0,e.immediateExceptions)},e.subscribe=function(e,o){if("function"!=typeof o)return!1;e="symbol"==typeof e?e.toString():e,Object.prototype.hasOwnProperty.call(t,e)||(t[e]={});var r="uid_"+String(++n);return t[e][r]=o,r},e.subscribeAll=function(t){return e.subscribe(o,t)},e.subscribeOnce=function(t,n){var o=e.subscribe(t,(function(){e.unsubscribe(o),n.apply(this,arguments)}));return e},e.clearAllSubscriptions=function(){t={}},e.clearSubscriptions=function(e){var n;for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&0===n.indexOf(e)&&delete t[n]},e.countSubscriptions=function(e){var n,o,r=0;for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&0===n.indexOf(e)){for(o in t[n])r++;break}return r},e.getSubscriptions=function(e){var n,o=[];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&0===n.indexOf(e)&&o.push(n);return o},e.unsubscribe=function(n){var o,r,i,s=function(e){var n;for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&0===n.indexOf(e))return!0;return!1},a="string"==typeof n&&(Object.prototype.hasOwnProperty.call(t,n)||s(n)),c=!a&&"string"==typeof n,u="function"==typeof n,f=!1;if(!a){for(o in t)if(Object.prototype.hasOwnProperty.call(t,o)){if(r=t[o],c&&r[n]){delete r[n],f=n;break}if(u)for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&r[i]===n&&(delete r[i],f=!0)}return f}e.clearSubscriptions(n)}}(r)),void 0!==e&&e.exports&&(t=e.exports=r),t.PubSub=r,e.exports=t=r}("object"==typeof window&&window||U)}(M,M.exports);var K,L=(K=M.exports)&&K.__esModule&&Object.prototype.hasOwnProperty.call(K,"default")?K.default:K;function Y(e){return new Promise((function(t,n){var o;"undefined"!=typeof requestIdleCallback?requestIdleCallback((function(){var o;null===(o=e())||void 0===o||o.then(t).catch(n)}),{timeout:500}):null===(o=e())||void 0===o||o.then(t).catch(n)}))}function F(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))}var X="undefined"!=typeof Blob?function(e){return new Blob([e]).size}:function(e){return e.length};function G(e){var t=[];try{t=JSON.parse(e)}catch(e){}return t}var H=61440;function W(e,t,n){void 0===n&&(n="POST");var o=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers);if(t.securedPost)return t.securedPost(e,G(t.body),{overideCreateSFUHeaders:!0,headers:o,antiFraudConfig:{apiProtection:{signatureLevel:2,withCredentials:!1}}});if("undefined"!=typeof fetch){var r="keepalive"in Request.prototype&&t.keepalive||void 0;if(r)z(t.body)>H&&(r=void 0);return fetch(e,{method:n,headers:o,keepalive:r,body:t.body})}return new Promise((function(r,i){var s=new XMLHttpRequest;s.open(n,e),Object.keys(o).forEach((function(e){s.setRequestHeader(e,o[e])})),s.onload=function(){r(s.response)},s.onerror=function(){i(s.response)},s.send(t.body)}))}function z(e){try{return X(JSON.stringify(e))}catch(e){return 0}}var Q=function(){function e(e){this.INTERVAL_PERIOD=1e4,this.enable=!0,this.preState="",Object.assign(this,e),this.intervalCallee(),this.unloadCallee()}return e.prototype.onInterval=function(){return Promise.resolve()},e.prototype.onFinish=function(){return Promise.resolve()},e.prototype.onError=function(e){return Promise.resolve()},e.prototype.onUnload=function(){},e.prototype.onReVisible=function(){},e.prototype.unloadCallee=function(){var e=this;document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e.onUnload(),"hidden"===e.preState&&"visible"===document.visibilityState&&e.onReVisible(),e.preState=document.visibilityState})),window.addEventListener("pagehide",(function(){e.onUnload()}),!1),window.onbeforeunload=function(){e.onUnload()}},e.prototype.intervalCallee=function(){var e=this;this.enable&&this.onInterval().then(this.onFinish).catch(this.onError).then((function(){return F(e.INTERVAL_PERIOD)})).then((function(){return e.intervalCallee()}))},e.prototype.trigger=function(e){this.enable=e},e}(),$="debugview",Z=function(){function e(e){this.options=e}return e.prototype.init=function(e){throw"no implement"},e.prototype.logDirectly=function(e,t){throw"no implement"},e.prototype.logBatchly=function(e){throw"no implement"},e.prototype.logJSBridge=function(e){throw"no implement"},e.prototype.preProcess=function(e){throw"no implement"},e.prototype.initScheduler=function(){throw"no implement"},e.prototype.isTssEvent=function(e){throw"no implement"},e.prototype.logEvent=function(e){var t=this;return Y((function(){return t.realLogEvent(e)}))},e.prototype.logEventWithoutSchedule=function(e){return this.realLogEvent(e)},e.prototype.logExitPageEvent=function(e){return this.realLogEvent(e,{isExitPage:!0})},e.prototype.realLogEvent=function(e,t){var n=this;return this.preProcess(e).then((function(e){L.publish($,e);var o=n.isTssEvent&&n.isTssEvent(e),r=null==t?void 0:t.isExitPage;return(null==t?void 0:t.isExitPage)||o?n.logDirectly(e,{isExitPage:r,isTss:o}):n.options.sendImmediately?n.logDirectly(e):n.logBatchly(e)}))},e}(),ee=new Map,te=function(){function e(e){this.options={on:!1,packageName:"@shopee/tracking"},this.options.packageName=null!=e?e:"@shopee/tracking"}return e.prototype.config=function(e){var t,n;"on"in e&&(this.options.on=null!==(t=e.on)&&void 0!==t&&t),"packageName"in e&&(this.options.packageName=null!==(n=e.packageName)&&void 0!==n?n:"@shopee/tracking")},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.options.on&&console.log.apply(console,s(["[".concat(this.options.packageName," info]")],e,!1))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.options.on&&console.warn.apply(console,s(["[".concat(this.options.packageName," warn]")],e,!1))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.options.on&&console.error.apply(console,s(["[".concat(this.options.packageName," error]")],e,!1))},e}();var ne=function(e){function n(t,n){var o=e.call(this,t||"Exposure Error.")||this;return o.code=n,o}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}(n,e),n}(Error);e.DEBUG_VIEW_TOPIC=$,e.ExposureError=ne,e.ITracker=Z,e.IndexedDBStorage=P,e.Logger=te,e.MemoStorage=R,e.PubSub=L,e.Scheduler=Q,e.byteSize=X,e.commonStore=N,e.constraintSize=function(e,t,n){void 0===n&&(n=1e6);var o=[e],r=z(e),i=Math.ceil(r/n);if(i<2)return o;for(;o.length<i;){var s=o.reduce((function(e,n){var o=t(n);return e.push.apply(e,o),e}),[]);if(!(s.length>o.length))break;o=s}return o},e.detectBrowser=function(){return void 0===j?"unknown":-1!==j.userAgent.indexOf("Chrome")?"Chrome":-1!==j.userAgent.indexOf("Firefox")?"Firefox":-1!==j.userAgent.indexOf("MSIE")?"Internet Exploder":-1!==j.userAgent.indexOf("Edge")?"Edge":-1!==j.userAgent.indexOf("Safari")?"Safari":-1!==j.userAgent.indexOf("Opera")?"Opera":"Others"},e.detectConnection=function(){if(void 0===j)return"unknown";var e=j.connection||j.mozConnection||j.webkitConnection;return e&&e.effectiveType||"unknown"},e.detectOS=function(){var e="Unknown OS";return-1!=j.appVersion.indexOf("Win")&&(e="Windows"),-1!=j.appVersion.indexOf("Mac")&&(e="MacOS"),-1!=j.appVersion.indexOf("X11")&&(e="UNIX"),-1!=j.appVersion.indexOf("Linux")&&(e="Linux"),e},e.document=k,e.generateDeferredPromise=function(){var e,t;return{promise:new Promise((function(n,o){var r;e=(r=[n,o])[0],t=r[1]})),reject:t,resolve:e}},e.getCookie=function(e){if("undefined"!=typeof document){var t="; ".concat(document.cookie).split("; ".concat(e,"="));return 2===t.length?t.pop().split(";").shift():void 0}},e.getDEDeviceID=function(){var e="de_device_id",t="";try{(t=localStorage.getItem(e))||(t=_(),localStorage.setItem(e,t))}catch(e){console.warn(e,"gerenate by uuid"),t=_()}return t},e.getEndpoint=function(e,t,n,o){if("apms"===n)return"https://patronus.".concat(q[e],"idata.shopeemobile.com/event-receiver/api/v4/").concat(t);if("v4/ubta"===t&&(null==o?void 0:o.enableNewDomain))return"https://ubta.tracking.".concat(q[e],"shopee").concat(J[n],"/v4/event_batch");if(!o)return"https://c-api-bit.".concat(q[e],"shopeemobile.com/").concat(t,"/").concat(n);var r=o.isTss,i=o.enableNewDomain,s=i?"https://ubt.tracking.".concat(q[e],"shopee").concat(J[n]):"https://c-api-bit.".concat(q[e],"shopeemobile.com"),a="".concat(s,"/").concat(t,"/").concat(n);return r&&i?a="".concat(s,"/v4/tss/event_batch"):r&&!i?a="".concat(s,"/v4/tss/tr/").concat(n):!r&&i&&(a="".concat(s,"/v4/event_batch")),a},e.location=V,e.navigator=j,e.pick=function(e,t){var n={};return t.forEach((function(t){n[t]=e[t]})),n},e.request=W,e.runningInstance=ee,e.safeParse=G,e.scheduleWhenIdle=Y,e.sendBeacon=function(e,t){"undefined"!=typeof navigator&&navigator.sendBeacon?navigator.sendBeacon(e,t):W(e,{headers:{"Content-Type":"application/json"},body:t})},e.sleep=F,e.trackingSessionManager=A,e.uuidv4=_,e.withRetry=function e(t,n,o){return void 0===n&&(n=1e3),t().catch((function(r){return console.warn(r),"number"==typeof o&&o--,"INF"===o||o>0?F(Math.min(n,2e4)).then((function(){return e(t,2*n,o)})):Promise.reject(r)}))},Object.defineProperty(e,"__esModule",{value:!0})}));