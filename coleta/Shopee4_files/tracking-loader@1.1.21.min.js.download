(function(){"use strict";var DEBUG_VIEW_TOKEN_KEY="tms_debug_view_token",DEBUG_VIEW_OPTIONS_STORAGE_KEY="tms_debug_view_options",VISUALISATION_OPTIONS_STORAGE_KEY="tms_visualisation_options",VISUALISATION_MODE_KEY="tms_visualisation_mode",SDK_ENV="prod",addressMap={dev:"/dist",prod:"https://deo.shopeemobile.com/shopee/shopee-trackingsdk-live-sg",staging:"https://tms.traffic.staging.shopee.io/sdk",test:"https://tms.traffic.test.shopee.io/sdk"},CDNAddress=addressMap[SDK_ENV],scriptAMDMap={requireJS:"".concat(CDNAddress,"/require.js"),trackingSDKRequireJS:"".concat(CDNAddress,"/require-trackingsdk.js")},sdkConfigLock=!1,sdkConfig$1=void 0;function isDebugModeNeeded(){try{if(new URL(self.window.location.href).searchParams.get(DEBUG_VIEW_TOKEN_KEY))return!0;var n=self.window.localStorage.getItem(DEBUG_VIEW_OPTIONS_STORAGE_KEY);return Boolean(n)}catch(n){return!1}}function isVisualisationNeeded(){try{if(self.window.localStorage.getItem(VISUALISATION_OPTIONS_STORAGE_KEY))return!0;var n=new URL(self.window.location.href);return!!new URLSearchParams(n.search).get(VISUALISATION_MODE_KEY)}catch(n){return!1}}function getSDKConfig(n){if(void 0===n&&(n=!1),sdkConfigLock)return Promise.resolve(sdkConfig$1);sdkConfigLock=!0;var e=n?"_testing":"";return new Promise((function(n,t){fetch("https://content.garena.com/shopee/track_config/split_by_market_config".concat(e,".json")).then((function(n){if(!n.ok)throw new Error("Response was not ok");return n.json()})).then((function(e){sdkConfig$1=e,n(e)})).catch((function(n){t(n)}))}))}function getInitParams(){var n=window.trackingSDK;if(n&&n.param)return"function"==typeof n.param?n.param()||n.param("ubt"):n.param}function hasDynamicImport(){var n=Promise&&Promise.prototype&&Promise.prototype.then,e=n&&Promise.resolve(!1);if(!n)return{then:function(n){n(!1)}};try{var t=Function('return import("data:text/javascript,")')();return t.then&&"function"==typeof t.then?t.then((function(){return!0}),(function(){return!1})):e}catch(n){return e}}function loadScript(n,e){var t=document.createElement("script");t.async=!0,t.onload=e,t.src=n,document.body.appendChild(t)}function loadRequireJs(n){loadScript(requireLibURL,(function(){var e,t;null===(t=null===(e=window.trackingSDK)||void 0===e?void 0:e.requirejs)||void 0===t||t.config({onNodeCreated:function(n){n.setAttribute("crossorigin","anonymous")}}),n()}))}var requireLibURL=scriptAMDMap.trackingSDKRequireJS,githash="7f3ca14",depMapping={core:["@shopee/tracking-core@".concat(githash)],ubt:["@shopee/tracking-ubt@".concat(githash)],algo:["@shopee/tracking-algo@".concat(githash)],apms:["@shopee/tracking-apms@".concat(githash)],mmp:["@shopee/tracking-mmp@".concat(githash)],exposure:["@shopee/tracking-exposure@".concat(githash)],debugview:["@shopee/tracking-internal-debugview@".concat(githash),isDebugModeNeeded],visualisation:["@shopee/tracking-internal-visualisation@".concat(githash),isVisualisationNeeded]},getDepAddress=function(n){return n.includes("-internal-")?"".concat(addressMap.staging,"/amd/").concat(n,".min.js"):"".concat(CDNAddress,"/amd/").concat(n,".min.js")},getEsDepAddress=function(n){return n.includes("-internal-")?"".concat(addressMap.staging,"/es/").concat(n,".min.js"):"".concat(CDNAddress,"/es/").concat(n,".min.js")},sdkConfig=void 0;function loadEntry(enableDynamicImport){var require;enableDynamicImport||(require=window.trackingSDK.require,require.config({waitSeconds:30}));var trackingSDK=window.trackingSDK,loadDeps=function(input){var _a=Array.isArray(input)?[input[0],"function"==typeof input[1]?input[1](input[0]):input[1]]:[input,"function"==typeof trackingSDK.param?trackingSDK.param(input):trackingSDK.param],name=_a[0],_b=_a[1],initParams=void 0===_b?{}:_b,depConfig=depMapping[name];if(depConfig){var depName=depConfig[0],_c=depConfig[1],isDepNeeded=void 0===_c?function(){return!0}:_c;if(isDepNeeded()){console.log("调 require 顺序",depName);var requireCallback=function(n){try{var e=new("default"in n?n.default:n)(initParams);e.init({version:trackingSDK.version,sdkConfig:sdkConfig}).then((function(){trackingSDK[name]=function(n){for(var t,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];return(t=e)[n].apply(t,i)},(trackingSDK.store[name]||[]).forEach((function(n){var e;(e=trackingSDK)[name].apply(e,n)})),delete trackingSDK.store[name]}))}catch(n){console.error("[@shopee/tracking-loader error] ".concat(name," failed to init"),n)}};if(enableDynamicImport){var url=getEsDepAddress(depName);return eval("import('".concat(url,"').then(requireCallback);"))}return require?require([getDepAddress(depName)],(function(n){return requireCallback(n)})):void 0}}else console.error("[@shopee/tracking-loader error] ".concat(name," does not exist"))};trackingSDK.load=function(n){null==n||n.forEach((function(n){var e="ubt",t=trackingSDK.param;"string"==typeof n&&(e=n),Array.isArray(n)&&(e=n[0]||e,t=n[1]||t),e in depMapping&&trackingSDK.__generateModule(e),loadDeps([e,t])}))};var loadModules=function(){var n;if(trackingSDK){var e=trackingSDK.dep;enableDynamicImport?null===(n=loadDeps("ubt"))||void 0===n||n.then((function(){var n=null==e?void 0:e.filter((function(n){return"ubt"!==n}));null==n||n.forEach(loadDeps)})):"function"==typeof require&&(null==e||e.forEach(loadDeps))}};loadModules()}var initParams=getInitParams();if(!initParams)throw new Error("Missing Init Params");getSDKConfig(initParams.__testCCMS__).then((function(n){sdkConfig=n})).catch((function(n){console.warn("get sdk config",n)})).then((function(){sdkConfig&&sdkConfig.dynamic_import?hasDynamicImport().then((function(n){n?loadEntry(!0):loadRequireJs((function(){loadEntry(!1)}))})):loadRequireJs((function(){loadEntry(!1)}))}))})();